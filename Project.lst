Microsoft (R) Macro Assembler Version 14.28.29335.0	    05/27/22 00:39:11
query_page_table.asm					     Page 1 - 1



				.686P		
				.MODEL flat, stdcall
				.STACK 4096

 00000000			.data
 00000000			.code

				; 名称：	query_page_table 
				; 功能：	从页表中查询页号，返回页的物理地址
				; 要求：	页号在页表中按升序排列，例如page[0] = pagetable[0] , page[1] = pagetable[1]
				;		页表中每一项的结构为 [page number] [page address]，其中page number 和 page address都为dword
				;		也就是说，在页表中一对page number 和 page address为数组的一个元素（一个页表项）
				; 参数： pPage_table:ptr dword
				;		page_number:dword
				;		number_size:dword
				; 返回：	EAX = 页框的物理地址(高20位)
								

 00000000			query_page_table proc
 = [ebp+8]							pPage_table		equ		[ebp+8]			;参数，页表指针
 = [ebp+12]							page_number		equ		[ebp+12]		;参数，页号
 = [ebp+16]							mumber_size		equ		[ebp+16]		;参数，页表项大小

 00000000  55							push        ebp                                 
 00000001  8B EC		                mov         ebp,esp
 00000003  56							push		esi							;保存esi edi
 00000004  57							push		edi

 00000005  8D 75 08						lea			esi,pPage_table				;加载页表
 00000008  8B 3E						mov			edi,[esi]
 0000000A  8B 45 0C						mov			eax,page_number				;页号在页表中的下标			

 0000000D  F7 65 10						mul			dword ptr mumber_size		;下标*元素大小				

 00000010  03 F8						add			edi,eax						;页表地址+元素偏移=页表项地址
 00000012  8B 47 04						mov			eax,dword ptr [edi+4]		;页的物理地址	
 00000015  C1 E0 0C						shl			eax,12						;页的物理地址移动到高20位，低12位置0

 00000018  5F							pop			edi
 00000019  5E							pop			esi
 0000001A  8B E5						mov			esp,ebp
 0000001C  5D							pop			ebp
 0000001D  C2 000C						ret			12							;清除参数			
 00000020			query_page_table endp
				end 
Microsoft (R) Macro Assembler Version 14.28.29335.0	    05/27/22 00:39:11
query_page_table.asm					     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

FLAT . . . . . . . . . . . . . .	GROUP
STACK  . . . . . . . . . . . . .	32 Bit	 00001000 Para	  Stack	  'STACK'	 
_DATA  . . . . . . . . . . . . .	32 Bit	 00000000 Para	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	32 Bit	 00000020 Para	  Public  'CODE'	


Procedures, parameters, and locals:

                N a m e                 Type     Value    Attr

query_page_table . . . . . . . .	P Near	 00000000 _TEXT	Length= 00000020 Public STDCALL


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 00000000h   
@DataSize  . . . . . . . . . . .	Number	 00000000h   
@Interface . . . . . . . . . . .	Number	 00000003h   
@Model . . . . . . . . . . . . .	Number	 00000007h   
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 FLAT
@fardata?  . . . . . . . . . . .	Text   	 FLAT
@fardata . . . . . . . . . . . .	Text   	 FLAT
@stack . . . . . . . . . . . . .	Text   	 FLAT
mumber_size  . . . . . . . . . .	Text   	 [ebp+16]
pPage_table  . . . . . . . . . .	Text   	 [ebp+8]
page_number  . . . . . . . . . .	Text   	 [ebp+12]

	   0 Warnings
	   0 Errors
